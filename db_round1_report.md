# DB 初步評估報告

**會議主題**：收集候選資料庫的向量整合可行性與優劣
**會議日期**：2025年9月1日
**與會者**：context7, sequential-thinking, task-master-ai, mcp-openmemory, serena, perplexity-mcp

---

## 1. 專案需求背景 (由 context7 總結)

我們的核心需求是在一個持續增長的資料庫（目前 195 萬筆）中，對包含**圖像、文稿和結構化 Metadata** 的複合型資料，實現高效、可擴展的混合式向量搜尋。關鍵目標是同時支援基於內容的相似性搜尋和基於 Metadata 的精確篩選。

---

## 2. 候選資料庫優劣勢分析 (由 sequential-thinking 分析)

- **PostgreSQL**: 混合查詢能力最強，但需整合外部對象儲存來管理大型檔案。
- **MongoDB**: 透過 GridFS 提供了內建的大型檔案儲存方案，開發體驗流暢，但複雜的關聯查詢是其短處。
- **Spanner**: 擴展性和一致性是其最大優勢，但對於當前資料規模而言，成本過高。
- **MySQL**: 原生向量功能缺失，高度依賴特定雲端廠商的客製化版本，方案較為零散。
- **MS SQL Server**: FileTable 和新的 VECTOR 型別在理論上是個好組合，但功能過新，風險較高，且成本昂貴。

---

## 3. 最新技術動態補充 (由 perplexity-mcp 整理)

- **PostgreSQL 模式**: 「外部對象儲存 + DB 內嵌向量與 Metadata」是社群公認的最佳實踐，模式成熟。
- **MongoDB 模式**: 「GridFS 存檔案 + 集合存向量與 Metadata」是其生態系內的標準做法，整合度高。
- **Spanner/MySQL/SQL Server**: Spanner 模式類似 PostgreSQL；MySQL 依賴雲端廠商；SQL Server 2025 的新功能組合潛力大但缺乏驗證。

---

## 4. 初步比較總表 (由 serena 製作)

| **評估維度** | **PostgreSQL 18+ (pgvector)** | **MongoDB 8.0 (Atlas Vector Search)** | **Google Cloud Spanner** | **MySQL 8.0+** | **MS SQL Server 2025** |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **處理混合資料能力** | **非常成熟**。將檔案儲存在外部（如S3），DB中儲存路徑、Metadata和向量。透過 SQL `JOIN` 和 `WHERE` 子句可實現最高自由度的混合查詢。 | **高度整合**。使用 **GridFS** 在 DB 內部儲存大型檔案，在集合中儲存 Metadata 和向量。查詢分為兩步（先查向量，再取檔案），但生態系內整合度高。 | **模式成熟但成本高**。與 PostgreSQL 模式類似，檔案存於外部（GCS），DB 處理 Metadata 和向量。查詢能力強，但主要優勢是全球擴展。 | **能力零散**。需要依賴特定雲端廠商的向量擴充，並自行整合外部對象儲存。混合查詢能力受限於廠商的實現。 | **潛力巨大但未經驗證**。理論上可透過 `FileTable` 和 `VECTOR` 型別實現最高度的整合，但功能過新，無生產案例和性能數據。 |
| **核心優勢** | - **最強的混合查詢能力**<br>- **開源、靈活、無鎖定**<br>- 生態系成熟穩定 | - **內建大型檔案儲存 (GridFS)**<br>- **開發體驗流暢**<br>- 彈性的資料模型 | - **全球級擴展與強一致性**<br>- 與 Google Cloud AI 深度整合 | - 社群龐大，人才儲備多 | - **與微軟生態系無縫整合**<br>- 統一的 T-SQL 查詢體驗 |
| **潛在劣勢** | - 需自行管理外部檔案儲存，增加架構複雜度 | - 複雜的 Metadata 關聯查詢較弱<br>- 高度依賴 Atlas 雲端服務 | - **成本與當前規模嚴重不匹配** | - **原生功能缺失，高度依賴廠商** | - **高昂的商業授權成本**<br>- **新功能風險高** |
| **適用場景** | - **業務邏輯與 Metadata 查詢複雜**的 AI 應用<br>- 需要精確控制查詢邏輯的團隊 | - **以非結構化內容為核心**的 RAG 或多媒體檢索系統<br>- 追求快速開發和雲端原生架構的團隊 | - 需要全球同步的超大規模多媒體資料庫 | - 已深度綁定特定 MySQL 雲端服務的團隊 | - 深度使用微軟技術棧，且願意嘗試最新技術的企業 |

---

## 5. 初步結論與建議

針對我們需同時處理圖像、文稿和結構化 Metadata 的特定需求，**PostgreSQL + pgvector** 和 **MongoDB Atlas Vector Search** 提供了最成熟、最務實的解決方案。

- **首選推薦：PostgreSQL**
  - **理由**: 我們的需求核心是「混合查詢」，即在精確的 Metadata 篩選後進行向量搜尋。PostgreSQL 在這方面提供了無與倫比的靈活性和性能。雖然需要額外管理對象儲存，但這種架構模式非常成熟，可以確保查詢邏輯的健壯性。

- **次選推薦：MongoDB**
  - **理由**: 如果我們希望簡化架構，避免管理外部儲存，MongoDB 的 GridFS 是一個巨大優勢。它提供了一個端到端的解決方案，特別適合以文件和圖像為中心的應用。如果對 Metadata 的複雜關聯查詢需求不高，這是一個非常有吸引力的選項。

**下一步建議**：

建立一個 PoC（概念驗證）專案，平行測試以下兩種架構：
1.  **PostgreSQL + S3**: 驗證其混合查詢的性能和開發複雜度。
2.  **MongoDB Atlas (with GridFS)**: 驗證其端到端整合的開發效率和查詢性能。

PoC 的結果將作為我們最終技術選型的決定性依據。
